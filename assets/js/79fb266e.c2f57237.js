"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5740],{1176:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"technical/repository","title":"Repository - Impl\xe9mentation technique","description":"Cette page d\xe9taille l\'impl\xe9mentation interne du Repository.","source":"@site/docs/technical/repository.md","sourceDirName":"technical","slug":"/technical/repository","permalink":"/go-orm-doc/docs/technical/repository","draft":false,"unlisted":false,"editUrl":"https://github.com/ESGI-M2/GO/tree/main/docs/docs/technical/repository.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"Repository interne"},"sidebar":"docs","previous":{"title":"M\xe9tadonn\xe9es & R\xe9flexion","permalink":"/go-orm-doc/docs/technical/metadata"},"next":{"title":"Query Builder interne","permalink":"/go-orm-doc/docs/technical/query-builder"}}');var s=i(4848),r=i(8453);const o={sidebar_position:4,sidebar_label:"Repository interne"},l="Repository - Impl\xe9mentation technique",d={},c=[{value:"Fonctionnalit\xe9s Go utilis\xe9es",id:"fonctionnalit\xe9s-go-utilis\xe9es",level:2},{value:"Packages standards",id:"packages-standards",level:3},{value:"Concepts Go avanc\xe9s",id:"concepts-go-avanc\xe9s",level:3},{value:"Patterns Go idiomatiques",id:"patterns-go-idiomatiques",level:3},{value:"Structure interne",id:"structure-interne",level:2},{value:"Syst\xe8me de Hooks",id:"syst\xe8me-de-hooks",level:2},{value:"Hooks support\xe9s",id:"hooks-support\xe9s",level:3},{value:"Soft Delete",id:"soft-delete",level:2},{value:"Syst\xe8me de Scopes",id:"syst\xe8me-de-scopes",level:2},{value:"Fonctionnalit\xe9s des scopes",id:"fonctionnalit\xe9s-des-scopes",level:3},{value:"Op\xe9rations CRUD",id:"op\xe9rations-crud",level:2},{value:"Create",id:"create",level:3},{value:"Read",id:"read",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"Gestion des erreurs",id:"gestion-des-erreurs",level:2},{value:"Optimisations",id:"optimisations",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"repository---impl\xe9mentation-technique",children:"Repository - Impl\xe9mentation technique"})}),"\n",(0,s.jsx)(n.p,{children:"Cette page d\xe9taille l'impl\xe9mentation interne du Repository."}),"\n",(0,s.jsx)(n.h2,{id:"fonctionnalit\xe9s-go-utilis\xe9es",children:"Fonctionnalit\xe9s Go utilis\xe9es"}),"\n",(0,s.jsx)(n.h3,{id:"packages-standards",children:"Packages standards"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"reflect"})," : Manipulation des structures et des champs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"context"})," : Support du contexte pour les op\xe9rations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sync"})," : Protection des m\xe9tadonn\xe9es partag\xe9es"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"errors"})," : Gestion des erreurs avec wrapping"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"time"})," : Gestion des timestamps et soft delete"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"concepts-go-avanc\xe9s",children:"Concepts Go avanc\xe9s"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Generics"})," : Repository typ\xe9 avec ",(0,s.jsx)(n.code,{children:"Repository[T]"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reflection"})," : Mapping dynamique struct \u2194 DB"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interfaces"})," : Abstraction des op\xe9rations CRUD"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type embedding"})," : Composition des fonctionnalit\xe9s"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Method sets"})," : API compl\xe8te sur les pointeurs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Interface detection"})," : D\xe9tection dynamique des hooks"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"patterns-go-idiomatiques",children:"Patterns Go idiomatiques"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Repository pattern"})," : Abstraction de la persistance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Options pattern"})," : Configuration flexible"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Context usage"})," : Propagation du contexte"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error wrapping"})," : Enrichissement des erreurs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Middleware pattern"})," : Hooks pre/post op\xe9rations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Chain of responsibility"})," : Ex\xe9cution des hooks"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"structure-interne",children:"Structure interne"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type Repository[T any] struct {\n    dialect    Dialect\n    metadata   *Metadata\n    builder    QueryBuilder\n    hooks      []Hook\n    scopes     map[string]Scope\n    ctx        context.Context\n}\n\ntype Hook func(ctx context.Context, op Operation, entity interface{}) error\ntype Scope func(QueryBuilder) QueryBuilder\n"})}),"\n",(0,s.jsx)(n.h2,{id:"syst\xe8me-de-hooks",children:"Syst\xe8me de Hooks"}),"\n",(0,s.jsx)(n.p,{children:"Les hooks permettent d'ex\xe9cuter du code avant/apr\xe8s les op\xe9rations :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// D\xe9finition des hooks via interfaces\ntype BeforeCreate interface {\n    BeforeCreate() error\n}\n\ntype AfterCreate interface {\n    AfterCreate() error\n}\n\n// Ex\xe9cution\nfunc (r *Repository) executeHooks(hookType string, entity interface{}) error {\n    if hook, ok := entity.(BeforeCreate); ok && hookType == "BeforeCreate" {\n        return hook.BeforeCreate()\n    }\n    // ... autres hooks\n    return nil\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"hooks-support\xe9s",children:"Hooks support\xe9s"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"BeforeCreate/AfterCreate"}),"\n",(0,s.jsx)(n.li,{children:"BeforeSave/AfterSave"}),"\n",(0,s.jsx)(n.li,{children:"BeforeUpdate/AfterUpdate"}),"\n",(0,s.jsx)(n.li,{children:"BeforeDelete/AfterDelete"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"soft-delete",children:"Soft Delete"}),"\n",(0,s.jsxs)(n.p,{children:["Impl\xe9mentation du soft delete via un champ ",(0,s.jsx)(n.code,{children:"deleted_at"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func (r *Repository) SoftDelete(entity interface{}) error {\n    if !r.metadata.SoftDeletes {\n        return ErrSoftDeletesNotEnabled\n    }\n    \n    r.setDeletedAt(entity)\n    return r.Save(entity)\n}\n\nfunc (r *Repository) Restore(entity interface{}) error {\n    r.clearDeletedAt(entity)\n    return r.Save(entity)\n}\n\nfunc (r *Repository) FindTrashed() ([]T, error) {\n    return r.builder.\n        WhereNotNull("deleted_at").\n        Find()\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"syst\xe8me-de-scopes",children:"Syst\xe8me de Scopes"}),"\n",(0,s.jsx)(n.p,{children:"Les scopes sont des fonctions r\xe9utilisables qui modifient le query builder :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// D\xe9finition d\'un scope\nrepo.AddScope("active", func(q QueryBuilder) QueryBuilder {\n    return q.Where("active", "=", true)\n})\n\n// Utilisation\nusers, err := repo.\n    Scope("active").\n    Where("age", ">", 18).\n    Find()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"fonctionnalit\xe9s-des-scopes",children:"Fonctionnalit\xe9s des scopes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cha\xeenables avec le query builder"}),"\n",(0,s.jsx)(n.li,{children:"Support des arguments"}),"\n",(0,s.jsx)(n.li,{children:"R\xe9utilisables"}),"\n",(0,s.jsx)(n.li,{children:"Combinables"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"op\xe9rations-crud",children:"Op\xe9rations CRUD"}),"\n",(0,s.jsx)(n.h3,{id:"create",children:"Create"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Validation des champs requis"}),"\n",(0,s.jsx)(n.li,{children:"Ex\xe9cution des hooks pre-create"}),"\n",(0,s.jsx)(n.li,{children:"Construction de la requ\xeate INSERT"}),"\n",(0,s.jsx)(n.li,{children:"Ex\xe9cution et r\xe9cup\xe9ration de l'ID"}),"\n",(0,s.jsx)(n.li,{children:"Mise \xe0 jour de l'entit\xe9"}),"\n",(0,s.jsx)(n.li,{children:"Ex\xe9cution des hooks post-create"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"read",children:"Read"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Construction du SELECT"}),"\n",(0,s.jsx)(n.li,{children:"Ex\xe9cution de la requ\xeate"}),"\n",(0,s.jsx)(n.li,{children:"Mapping des r\xe9sultats vers T"}),"\n",(0,s.jsx)(n.li,{children:"Gestion des relations"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"D\xe9tection des champs modifi\xe9s"}),"\n",(0,s.jsx)(n.li,{children:"Hooks pre-update"}),"\n",(0,s.jsx)(n.li,{children:"Construction de l'UPDATE"}),"\n",(0,s.jsx)(n.li,{children:"Ex\xe9cution et v\xe9rification"}),"\n",(0,s.jsx)(n.li,{children:"Hooks post-update"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Hooks pre-delete"}),"\n",(0,s.jsx)(n.li,{children:"Soft delete si activ\xe9"}),"\n",(0,s.jsx)(n.li,{children:"Hard delete sinon"}),"\n",(0,s.jsx)(n.li,{children:"Hooks post-delete"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"gestion-des-erreurs",children:"Gestion des erreurs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ErrNotFound : Entit\xe9 non trouv\xe9e"}),"\n",(0,s.jsx)(n.li,{children:"ErrValidation : Validation \xe9chou\xe9e"}),"\n",(0,s.jsx)(n.li,{children:"ErrHookFailed : Erreur dans un hook"}),"\n",(0,s.jsx)(n.li,{children:"ErrTransaction : Erreur transactionnelle"}),"\n",(0,s.jsx)(n.li,{children:"ErrSoftDeletesNotEnabled : Soft delete non activ\xe9"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"optimisations",children:"Optimisations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"R\xe9utilisation des requ\xeates pr\xe9par\xe9es"}),"\n",(0,s.jsx)(n.li,{children:"Batch operations pour les collections"}),"\n",(0,s.jsx)(n.li,{children:"D\xe9tection intelligente des hooks"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Voir la documentation utilisateur pour les exemples d'utilisation."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);